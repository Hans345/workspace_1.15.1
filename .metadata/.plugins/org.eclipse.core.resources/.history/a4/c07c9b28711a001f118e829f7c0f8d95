#include "task_handler.h"


//-----------------------------------------------------------------------------------------------------------------------
/****** VARIABLES ******/
static uint16_t time_val = 0;
uint8_t handler_state, prev_handler_state;

void enter_handler_state(uint8_t state)
{
    switch(state){
    //--------------------------------------------------------------------------------------
        case IDLE:

        break;
    //--------------------------------------------------------------------------------------
        case LEDON:
			/****** LED2 ******/
        	HAL_GPIO_WritePin(LD2, LD2_PIN, GPIO_PIN_SET);
        break;
    //--------------------------------------------------------------------------------------
        case LEDBLINK:

        break;
    //--------------------------------------------------------------------------------------
        default:
        break;
    //--------------------------------------------------------------------------------------
    }
}

//-----------------------------------------------------------------------------------------------------------------------

void exec_handler_state(uint8_t state)
{
    switch(state){
    //--------------------------------------------------------------------------------------
        case IDLE:

        break;
    //--------------------------------------------------------------------------------------
        case LEDON:
		/*if(HAL_GPIO_ReadPin(B1, B1_PIN))
		{
			dT = __HAL_TIM_GET_COUNTER(&htim16) - time_val; // 100us
			time_val = __HAL_TIM_GET_COUNTER(&htim16);
			if(time_val > 10000)
			{
				set_handler_state(IDLE);
			}
		}*/
        break;
    //--------------------------------------------------------------------------------------
        case LEDBLINK:

        break;
      //--------------------------------------------------------------------------------------
      default:
      break;
      //--------------------------------------------------------------------------------------
    }
}

//-----------------------------------------------------------------------------------------------------------------------

void leave_handler_state(uint8_t state)
{
    switch(state){
    //--------------------------------------------------------------------------------------
        case IDLE:
        break;
    //--------------------------------------------------------------------------------------
        case LEDON:
        break;
    //--------------------------------------------------------------------------------------
        case LEDBLINK:
        break;
    //--------------------------------------------------------------------------------------
        default:
        break;
    //--------------------------------------------------------------------------------------
    }
}

//-----------------------------------------------------------------------------------------------------------------------

void handler_task(void)
{
    exec_handler_state(handler_state);
}

void set_handler_state(uint8_t state)
{
    prev_handler_state = handler_state;
    handler_state = state;
    leave_handler_state(prev_handler_state);
    enter_handler_state(state);
}

uint8_t get_handler_state(void)
{
    return handler_state;
}


void set_handler_currentTime(uint16_t dT)
{
    time_val = time_val + dT;
}

void reset_handler_currentTime(uint16_t dT)
{
    time_val = 0T;
}

